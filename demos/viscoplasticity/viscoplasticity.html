
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Viscoplastic fluid &#8212; dolfinx_optim</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'demos/viscoplasticity/viscoplasticity';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Elastoplasticity with exponential isotropic hardening" href="../elastoplasticity/elastoplasticity_exponential_hardening.html" />
    <link rel="prev" title="Three-dimensional limit analysis problem using Semi-Definite Programming" href="../3D_soil_slope_limit_analysis/3D_soil_slope_limit_analysis.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">dolfinx_optim</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    dolfinx_optim documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Documented demos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3D_soil_slope_limit_analysis/3D_soil_slope_limit_analysis.html">Three-dimensional limit analysis problem using Semi-Definite Programming</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Viscoplastic fluid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elastoplasticity/elastoplasticity_exponential_hardening.html">Elastoplasticity with exponential isotropic hardening</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cartoon_texture_decomposition/cartoon_texture_decomposition.html">Cartoon-texture oscillation decomposition demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../api/cones.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cones</span></code></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/convex_function.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">convex_function</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/mosek_io.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mosek_io</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Viscoplastic fluid</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variational-principle">Variational principle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="viscoplastic-fluid">
<h1>Viscoplastic fluid<a class="headerlink" href="#viscoplastic-fluid" title="Link to this heading">#</a></h1>
<p>Viscoplastic or yield-stress fluids are a particular class of non-Newtonian fluids which
behave like a standard Newtonian fluid only if the local stress reaches a critical threshold, the fluid <em>yield stress</em> <span class="math notranslate nohighlight">\(\tau_0\)</span>. If the stress is below <span class="math notranslate nohighlight">\(\tau_0\)</span>, the fluid behaves like a rigid solid. Such fluids occur in many industrial applications such as civil engineering (fresh concrete), petroleum or cosmetics (crude oil, toothpaste, foams, mayonnaise), natural hazards (lava, muds), etc. One of the most simple model to describe such fluids is the <em>Bingham</em> model which assumes a linear Newtonian behavior, characterized by a viscosity <span class="math notranslate nohighlight">\(\mu\)</span>, above the yield stress. For recent reviews on yield stress fluids, we refer to <span id="id1">[<a class="reference internal" href="#id7" title="Neil J Balmforth, Ian A Frigaard, and Guillaume Ovarlez. Yielding to stress: recent developments in viscoplastic fluid mechanics. Annual review of fluid mechanics, 46:121–146, 2014.">Balmforth <em>et al.</em>, 2014</a>, <a class="reference internal" href="#id8" title="Philippe Coussot. Bingham’s heritage. Rheologica Acta, 56:163–176, 2017.">Coussot, 2017</a>]</span>.</p>
<p>There numerical resolution is notoriously difficult due to the non-smooth character of their behavior and of the underlying variational principle. Here, we show how computing such flows can be achieved using conic programming and interior-point solvers, for more details see <span id="id2">[<a class="reference internal" href="#id9" title="Jeremy Bleyer. Advances in the simulation of viscoplastic fluid flows using interior-point methods. Computer Methods in Applied Mechanics and Engineering, 330:368–394, 2018.">Bleyer, 2018</a>, <a class="reference internal" href="#id10" title="Jeremy Bleyer, Mathilde Maillard, Patrick De Buhan, and Philippe Coussot. Efficient numerical computations of yield stress fluid flows using second-order cone programming. Computer Methods in Applied Mechanics and Engineering, 283:599–614, 2015.">Bleyer <em>et al.</em>, 2015</a>]</span>.
<span class="math notranslate nohighlight">\(\newcommand{\bu}{\boldsymbol{u}}\newcommand{\be}{\boldsymbol{e}}\newcommand{\bd}{\boldsymbol{d}}\newcommand{\bf}{\boldsymbol{f}}\newcommand{\dOm}{\,\text{d}\Omega}\newcommand{\bD}{\boldsymbol{D}}\)</span></p>
<section id="variational-principle">
<h2>Variational principle<a class="headerlink" href="#variational-principle" title="Link to this heading">#</a></h2>
<p>In the case of a steady-state flow under a body force <span class="math notranslate nohighlight">\(\boldsymbol{f}\)</span>, the solution velocity field <span class="math notranslate nohighlight">\(\bu\)</span> is obtained from the following minimum principle:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rl}
\displaystyle{\min_{\bu}} &amp; \displaystyle{\int_{\Omega} \phi(\bd)\dOm - \int_{\Omega}\boldsymbol{f}\cdot\bu\dOm}\\
\text{s.t.} &amp; \bd = \text{sym}(\nabla \bu)\\
&amp; \operatorname{div}\bu = 0
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\phi(\bd)\)</span> is the dissipation potential corresponding to the material. In the case of a Bingham material characterized by a viscosity <span class="math notranslate nohighlight">\(\mu\)</span> and a yield stress <span class="math notranslate nohighlight">\(\tau_0\)</span>, the potential is given by:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi(\bd) = \mu\bd:\bd + \sqrt{2}\tau_0 \sqrt{\bd:\bd}
\end{equation*}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a Herschel-Bulkley fluid, the viscous part is a power-law characterized by a viscosity coefficient <span class="math notranslate nohighlight">\(K\)</span> and an exponent <span class="math notranslate nohighlight">\(m\)</span>. The potential is given by:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi(\bd) = \dfrac{K}{m+1}2^{(m+1)/2}\|\bd\|^{m+1} + \sqrt{2}\tau_0 \sqrt{\bd:\bd}
\end{equation*}\]</div>
</div>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>We consider the problem of a lid-driven square cavity. No slip boundary conditions are enforced on all boundaries except on the top boundary on which a uniform velocity <span class="math notranslate nohighlight">\(\bu=\be_x\)</span> is imposed.</p>
<p>We first import the relevant modules and create a square mesh.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">dolfinx</span> <span class="kn">import</span> <span class="n">fem</span><span class="p">,</span> <span class="n">mesh</span>
<span class="kn">import</span> <span class="nn">ufl</span>
<span class="kn">from</span> <span class="nn">dolfinx_optim.mosek_io</span> <span class="kn">import</span> <span class="n">MosekProblem</span>
<span class="kn">from</span> <span class="nn">dolfinx_optim.convex_function</span> <span class="kn">import</span> <span class="n">QuadraticTerm</span><span class="p">,</span> <span class="n">L2Norm</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">75</span>
<span class="n">domain</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">create_unit_square</span><span class="p">(</span>
    <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">diagonal</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">DiagonalType</span><span class="o">.</span><span class="n">crossed</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We define no-slip boundary conditions on the bottom and lateral sides and impose a unit horizontal velocity <span class="math notranslate nohighlight">\(\bu=\be_x\)</span> on the top boundary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get top boundary and remaining part of the cavity</span>
<span class="k">def</span> <span class="nf">sides</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.99</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>



<span class="c1"># P2 interpolation for velocity</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)))</span>
<span class="n">side_dofs</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_geometrical</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">sides</span><span class="p">)</span>
<span class="n">top_dofs</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_geometrical</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
<span class="n">Vx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">collapse</span><span class="p">()</span>
<span class="n">middle_dofs</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_geometrical</span><span class="p">((</span><span class="n">V</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Vx</span><span class="p">),</span> <span class="n">middle</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


<span class="n">bc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">fem</span><span class="o">.</span><span class="n">dirichletbc</span><span class="p">(</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span> <span class="n">top_dofs</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span>
    <span class="n">fem</span><span class="o">.</span><span class="n">dirichletbc</span><span class="p">(</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span> <span class="n">side_dofs</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We now start defining the optimization problem by adding the velocity <span class="math notranslate nohighlight">\(\bu\)</span> as an optimization variable on a <span class="math notranslate nohighlight">\(\mathbb{P}_2\)</span> function space, constrained to the previously defined boundary conditions. We also enforce the mass conservation condition by adding the following constraint:</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega p\:\operatorname{div}(\bu)\: \dOm = 0 \quad \forall p\in V_p
\]</div>
<p>where <span class="math notranslate nohighlight">\(V_p\)</span> is the pressure space for pressure test functions <span class="math notranslate nohighlight">\(p\)</span> (used here as Lagrange multipliers). We use a Lagrange <span class="math notranslate nohighlight">\(\mathbb{P}_1\)</span> function space for its discretization, thereby corresponding to a Taylor-Hood mixed formulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob</span> <span class="o">=</span> <span class="n">MosekProblem</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="s2">&quot;Viscoplastic fluid&quot;</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">add_var</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="n">bc</span><span class="p">)</span>

<span class="c1"># mass conservation condition</span>
<span class="c1"># P1 interpolation for pressure (Lagrange multiplier)</span>
<span class="n">Vp</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="n">Vp</span><span class="p">)</span>
<span class="n">mass_conserv</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">ufl</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dx</span>
<span class="n">prob</span><span class="o">.</span><span class="n">add_eq_constraint</span><span class="p">(</span><span class="n">mass_conserv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now define the fluid viscosity <span class="math notranslate nohighlight">\(\mu\)</span> and yield stress <span class="math notranslate nohighlight">\(\tau_0\)</span>. The Bingham number <span class="math notranslate nohighlight">\(\text{Bi}=\tau_0 L/\mu V\)</span> represents the proportion of plastic behavior with respect to the viscous behavior. We also introduce a vector representation for the strain rate field such that:</p>
<div class="math notranslate nohighlight">
\[
\|\boldsymbol{d}\|_2^2 = \sum d_i^2 = \bD:\bD=D_{ij}D_{ij}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\bD=\text{sym}(\nabla \bu)\)</span> the strain rate tensor and <span class="math notranslate nohighlight">\(\boldsymbol{d}\)</span> its vectorial representation. We then define the viscous potential <span class="math notranslate nohighlight">\(\mu\bD:\bD\)</span> with a <code class="docutils literal notranslate"><span class="pre">QuadraticTerm</span></code> and the plastic potential <span class="math notranslate nohighlight">\(\sqrt{2}\tau_0\sqrt{\bD:\bD}\)</span> with a <code class="docutils literal notranslate"><span class="pre">L2Norm</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">tau0</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strain</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ufl</span><span class="o">.</span><span class="n">as_vector</span><span class="p">([</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ufl</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>


<span class="n">visc</span> <span class="o">=</span> <span class="n">QuadraticTerm</span><span class="p">(</span><span class="n">strain</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plast</span> <span class="o">=</span> <span class="n">L2Norm</span><span class="p">(</span><span class="n">strain</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># add viscous term mu*||strain||_2^2 (factor 2 because 1/2 in QuadraticTerm)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">add_convex_term</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">visc</span><span class="p">)</span>
<span class="c1"># add plastic term sqrt(2)*tau0*||strain||_2</span>
<span class="n">prob</span><span class="o">.</span><span class="n">add_convex_term</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau0</span> <span class="o">*</span> <span class="n">plast</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The problem is then solved. Note that we slightly relax the default solver tolerance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;log_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># deactivate solver output</span>
<span class="n">prob</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;tol_rel_gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">prob</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(36.88606848632506, 36.84887757188724)
</pre></div>
</div>
</div>
</div>
<p>We plot the resulting velocity contour lines</p>
<p>We finally compare the horizontal velocity profile against previous solutions for some Bingham numbers along vertical line <span class="math notranslate nohighlight">\(x=0.5\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">collapse</span><span class="p">()</span>
<span class="n">ux_vals</span> <span class="o">=</span> <span class="n">ux</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">middle_dofs</span><span class="p">]</span>
<span class="n">y_dofs</span> <span class="o">=</span> <span class="n">Vx</span><span class="o">.</span><span class="n">tabulate_dof_coordinates</span><span class="p">()[</span><span class="n">middle_dofs</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ux_vals</span><span class="p">,</span> <span class="n">y_dofs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;present computation&quot;</span><span class="p">)</span>
<span class="n">Bi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">mu</span><span class="p">))</span>
<span class="n">Bi_data_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">Bi_data_values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">Bi</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;viscoplastic_data.csv&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;oC3&quot;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;solution from [Bleyer et al., 2015]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$y$ coordinate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity $u_x$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7fc6bc67622febb151fde25ae249731e0e6d11bbfc8f8283d1259f7710f6a0db.png" src="../../_images/7fc6bc67622febb151fde25ae249731e0e6d11bbfc8f8283d1259f7710f6a0db.png" />
</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<div class="docutils container" id="id3">
<div role="list" class="citation-list">
<div class="citation" id="id7" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">BFO14</a><span class="fn-bracket">]</span></span>
<p>Neil J Balmforth, Ian A Frigaard, and Guillaume Ovarlez. Yielding to stress: recent developments in viscoplastic fluid mechanics. <em>Annual review of fluid mechanics</em>, 46:121–146, 2014.</p>
</div>
<div class="citation" id="id9" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">Ble18</a><span class="fn-bracket">]</span></span>
<p>Jeremy Bleyer. Advances in the simulation of viscoplastic fluid flows using interior-point methods. <em>Computer Methods in Applied Mechanics and Engineering</em>, 330:368–394, 2018.</p>
</div>
<div class="citation" id="id10" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">BMDBC15</a><span class="fn-bracket">]</span></span>
<p>Jeremy Bleyer, Mathilde Maillard, Patrick De Buhan, and Philippe Coussot. Efficient numerical computations of yield stress fluid flows using second-order cone programming. <em>Computer Methods in Applied Mechanics and Engineering</em>, 283:599–614, 2015.</p>
</div>
<div class="citation" id="id8" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">Cou17</a><span class="fn-bracket">]</span></span>
<p>Philippe Coussot. Bingham’s heritage. <em>Rheologica Acta</em>, 56:163–176, 2017.</p>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./demos/viscoplasticity"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../3D_soil_slope_limit_analysis/3D_soil_slope_limit_analysis.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Three-dimensional limit analysis problem using Semi-Definite Programming</p>
      </div>
    </a>
    <a class="right-next"
       href="../elastoplasticity/elastoplasticity_exponential_hardening.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Elastoplasticity with exponential isotropic hardening</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variational-principle">Variational principle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeremy Bleyer
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>